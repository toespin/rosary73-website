<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Members Dashboard - Rosary73</title>
  <meta name="description" content="Manage your Rosary73 account, upload prayers, subscribe, gift subscriptions, and donate">
  <link rel="icon" type="image/png" href="images/R73logo.png">
  
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%);
      min-height: 100vh;
      color: #ffffff;
    }
    
    .header {
      padding: 15px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      border-bottom: 1px solid rgba(255,255,255,0.1);
      position: sticky;
      top: 0;
      background: rgba(26, 26, 46, 0.95);
      backdrop-filter: blur(10px);
      z-index: 100;
    }
    
    .logo-link { display: flex; align-items: center; gap: 10px; text-decoration: none; }
    .logo { width: 40px; height: 40px; }
    .logo-text { color: #d4af37; font-size: 1.3rem; font-weight: 600; }
    .header-right { display: flex; align-items: center; gap: 20px; }
    .header-user { display: flex; align-items: center; gap: 10px; color: rgba(255,255,255,0.8); font-size: 0.9rem; }
    .header-user-name { color: #d4af37; font-weight: 600; }
    .logout-btn { background: rgba(255,255,255,0.1); border: 1px solid rgba(255,255,255,0.2); color: #fff; padding: 8px 16px; border-radius: 8px; cursor: pointer; font-size: 0.85rem; }
    
    .members-nav { background: rgba(212, 175, 55, 0.1); border-bottom: 1px solid rgba(212, 175, 55, 0.2); display: none; }
    .members-nav.visible { display: block; }
    .members-nav-inner { max-width: 1200px; margin: 0 auto; display: flex; justify-content: center; flex-wrap: wrap; gap: 5px; padding: 10px 20px; }
    .members-nav-item { display: flex; align-items: center; gap: 8px; padding: 12px 20px; color: rgba(255,255,255,0.8); text-decoration: none; border-radius: 10px; font-size: 0.95rem; font-weight: 500; transition: all 0.3s ease; cursor: pointer; border: none; background: transparent; }
    .members-nav-item:hover { background: rgba(212, 175, 55, 0.2); color: #fff; }
    .members-nav-item.active { background: rgba(212, 175, 55, 0.3); color: #d4af37; }
    .nav-divider { width: 1px; height: 30px; background: rgba(255,255,255,0.2); margin: 0 10px; }
    
    @media (max-width: 768px) {
      .header-user span:not(.header-user-name) { display: none; }
      .members-nav-inner { flex-direction: column; gap: 0; }
      .members-nav-item { justify-content: center; padding: 14px 20px; border-radius: 0; border-bottom: 1px solid rgba(255,255,255,0.05); width: 100%; }
      .nav-divider { width: 80%; height: 1px; margin: 5px auto; }
    }
    
    .main { max-width: 1200px; margin: 0 auto; padding: 30px 20px; }
    
    .login-gate { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 50px 40px; text-align: center; max-width: 450px; margin: 80px auto; }
    .login-gate-icon { font-size: 4rem; margin-bottom: 20px; }
    .login-gate h1 { color: #d4af37; margin-bottom: 10px; font-size: 1.8rem; }
    .login-gate p { color: rgba(255,255,255,0.7); margin-bottom: 30px; }
    .login-form { display: flex; flex-direction: column; gap: 15px; }
    .form-group { text-align: left; }
    .form-group label { display: block; color: rgba(255,255,255,0.7); font-size: 0.85rem; margin-bottom: 5px; }
    .form-input { width: 100%; padding: 14px 16px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: #fff; font-size: 1rem; }
    .form-input:focus { outline: none; border-color: #d4af37; }
    .form-input::placeholder { color: rgba(255,255,255,0.4); }
    .login-links { display: flex; justify-content: space-between; margin-top: 15px; font-size: 0.9rem; }
    .login-links a { color: #d4af37; text-decoration: none; }
    
    .dashboard { display: none; }
    .dashboard.visible { display: block; }
    
    .user-status-bar { background: linear-gradient(135deg, rgba(212, 175, 55, 0.1), rgba(212, 175, 55, 0.05)); border: 1px solid rgba(212, 175, 55, 0.2); border-radius: 12px; padding: 15px 20px; margin-bottom: 30px; display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
    .status-items { display: flex; gap: 20px; flex-wrap: wrap; }
    .status-item { display: flex; align-items: center; gap: 8px; color: rgba(255,255,255,0.8); font-size: 0.9rem; }
    .status-badge { padding: 4px 12px; border-radius: 20px; font-size: 0.8rem; font-weight: 600; }
    .status-trial { background: rgba(251, 191, 36, 0.2); color: #fbbf24; }
    .status-active { background: rgba(74, 222, 128, 0.2); color: #4ade80; }
    .status-expired { background: rgba(239, 68, 68, 0.2); color: #f87171; }
    .status-admin { background: rgba(147, 51, 234, 0.2); color: #a855f7; }
    
    .section-panel { display: none; background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 20px; padding: 30px; margin-bottom: 30px; }
    .section-panel.visible { display: block; }
    .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px; padding-bottom: 15px; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .section-header h2 { display: flex; align-items: center; gap: 10px; color: #d4af37; }
    .close-section { background: rgba(255,255,255,0.1); border: none; color: #fff; width: 36px; height: 36px; border-radius: 50%; cursor: pointer; font-size: 1.2rem; }
    
    .plans-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 25px; }
    .plan-card { background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 25px; text-align: center; cursor: pointer; position: relative; }
    .plan-card:hover { border-color: rgba(212, 175, 55, 0.5); }
    .plan-card.selected { border-color: #d4af37; background: rgba(212, 175, 55, 0.1); }
    .plan-card.popular::before { content: 'POPULAR'; position: absolute; top: -10px; left: 50%; transform: translateX(-50%); background: linear-gradient(135deg, #d4af37, #b8860b); color: #1a1a2e; padding: 4px 12px; border-radius: 10px; font-size: 0.7rem; font-weight: 700; }
    .plan-duration { font-size: 1.1rem; font-weight: 600; margin-bottom: 10px; }
    .plan-price { font-size: 2rem; font-weight: 700; color: #d4af37; }
    .plan-savings { color: #4ade80; font-size: 0.85rem; margin-top: 5px; }
    
    .payment-methods-section { margin-bottom: 20px; }
    .payment-group-title { color: rgba(255,255,255,0.6); font-size: 0.85rem; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
    .ph-only-tag { background: #4ade80; color: #1a1a2e; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600; }
    .payment-methods { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 10px; margin-bottom: 15px; }
    .payment-method { background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 15px; text-align: center; cursor: pointer; }
    .payment-method:hover { border-color: rgba(212, 175, 55, 0.5); }
    .payment-method.selected { border-color: #d4af37; background: rgba(212, 175, 55, 0.1); }
    .payment-method-icon { font-size: 1.5rem; margin-bottom: 5px; }
    .payment-method-name { font-size: 0.85rem; font-weight: 500; }
    
    .donation-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(100px, 1fr)); gap: 10px; margin-bottom: 20px; }
    .donation-amount { background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px 15px; text-align: center; cursor: pointer; }
    .donation-amount:hover { border-color: rgba(212, 175, 55, 0.5); }
    .donation-amount.selected { border-color: #d4af37; background: rgba(212, 175, 55, 0.1); }
    .donation-value { font-size: 1.3rem; font-weight: 700; color: #d4af37; }
    .custom-amount-input { display: flex; gap: 10px; align-items: center; margin-bottom: 20px; }
    .custom-amount-input input { flex: 1; padding: 14px 16px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: #fff; font-size: 1rem; }
    
    .gift-form { max-width: 500px; }
    .gift-form .form-group { margin-bottom: 20px; }
    .gift-form textarea { width: 100%; padding: 14px 16px; border-radius: 10px; border: 1px solid rgba(255,255,255,0.2); background: rgba(255,255,255,0.05); color: #fff; font-size: 1rem; resize: vertical; min-height: 100px; }
    
    .quick-stats { background: rgba(255,255,255,0.03); border: 1px solid rgba(255,255,255,0.08); border-radius: 16px; padding: 25px; }
    .quick-stats h3 { color: rgba(255,255,255,0.6); font-size: 0.9rem; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 20px; }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 20px; }
    .stat-item { text-align: center; }
    .stat-value { font-size: 2rem; font-weight: 700; color: #d4af37; }
    .stat-label { color: rgba(255,255,255,0.6); font-size: 0.85rem; margin-top: 5px; }
    
    .btn { display: inline-flex; align-items: center; justify-content: center; gap: 8px; padding: 14px 28px; border-radius: 10px; font-size: 1rem; font-weight: 600; cursor: pointer; border: none; text-decoration: none; }
    .btn-primary { background: linear-gradient(135deg, #d4af37, #b8860b); color: #1a1a2e; }
    .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3); }
    .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
    .btn-secondary { background: rgba(255,255,255,0.1); color: #fff; border: 1px solid rgba(255,255,255,0.2); }
    .btn-small { padding: 10px 18px; font-size: 0.9rem; }
    .btn-block { width: 100%; }
    
    .alert { padding: 15px 20px; border-radius: 10px; margin-bottom: 20px; display: flex; align-items: flex-start; gap: 12px; }
    .alert-error { background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); color: #f87171; }
    .alert-success { background: rgba(74, 222, 128, 0.1); border: 1px solid rgba(74, 222, 128, 0.3); color: #4ade80; }
    .alert-warning { background: rgba(251, 191, 36, 0.1); border: 1px solid rgba(251, 191, 36, 0.3); color: #fbbf24; }
    
    .spinner { width: 20px; height: 20px; border: 2px solid rgba(255,255,255,0.3); border-top-color: #d4af37; border-radius: 50%; animation: spin 1s linear infinite; }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .toast-container { position: fixed; bottom: 20px; right: 20px; z-index: 1000; }
    .toast { background: rgba(30, 30, 50, 0.95); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; padding: 15px 20px; margin-top: 10px; display: flex; align-items: center; gap: 10px; animation: slideIn 0.3s ease; max-width: 350px; }
    .toast.success { border-color: rgba(74, 222, 128, 0.3); }
    .toast.error { border-color: rgba(239, 68, 68, 0.3); }
    @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
    
    .footer { text-align: center; padding: 30px 20px; border-top: 1px solid rgba(255,255,255,0.1); margin-top: 50px; }
    .footer p { color: rgba(255,255,255,0.4); font-size: 0.85rem; }
    .footer a { color: #d4af37; text-decoration: none; }
    
    .hidden { display: none !important; }
    
    @media (max-width: 600px) {
      .user-status-bar { flex-direction: column; text-align: center; }
      .status-items { justify-content: center; }
      .login-gate { padding: 30px 20px; margin: 40px 20px; }
    }
  </style>
</head>
<body>
  <header class="header">
    <a href="index.html" class="logo-link">
      <img src="images/R73logo.png" alt="Rosary73" class="logo">
      <span class="logo-text">Rosary73</span>
    </a>
    <div class="header-right">
      <div class="header-user hidden" id="header-user">
        <span class="header-user-name" id="header-username">User</span>
        <button class="logout-btn" onclick="logout()">Logout</button>
      </div>
    </div>
  </header>

  <nav class="members-nav" id="members-nav">
    <div class="members-nav-inner">
      <a href="start-rosary.html" class="members-nav-item"><span>‚úùÔ∏è</span><span>Start Rosary</span></a>
      <a href="participate.html" class="members-nav-item"><span>üôè</span><span>Join Rosary</span></a>
      <a href="finished.html" class="members-nav-item"><span>üéß</span><span>Finished Rosaries</span></a>
      <span class="nav-divider"></span>
      <button class="members-nav-item" onclick="openSection('upload')" data-section="upload"><span>üìø</span><span>Upload Prayers</span></button>
      <button class="members-nav-item" onclick="openSection('subscribe')" data-section="subscribe"><span>‚≠ê</span><span>Subscribe</span></button>
      <button class="members-nav-item" onclick="openSection('gift')" data-section="gift"><span>üéÅ</span><span>Gift</span></button>
      <button class="members-nav-item" onclick="openSection('donate')" data-section="donate"><span>üíù</span><span>Donate</span></button>
    </div>
  </nav>

  <main class="main">
    <div class="login-gate" id="login-gate">
      <div class="login-gate-icon">üîê</div>
      <h1>Member Login</h1>
      <p>Sign in to access your dashboard</p>
      <form class="login-form" id="login-form">
        <div class="form-group">
          <label for="login-username">Username</label>
          <input type="text" id="login-username" class="form-input" placeholder="Enter your username" required>
        </div>
        <div class="form-group">
          <label for="login-password">Password</label>
          <input type="password" id="login-password" class="form-input" placeholder="Enter your password" required>
        </div>
        <button type="submit" class="btn btn-primary btn-block" id="login-btn">Sign In</button>
        <div class="login-links">
          <a href="signup.html">Create Account</a>
          <a href="forgot-password.html">Forgot Password?</a>
        </div>
      </form>
      <div id="login-error" class="alert alert-error hidden" style="margin-top: 20px;">
        <span>‚ùå</span>
        <span id="login-error-text"></span>
      </div>
    </div>

    <div class="dashboard" id="dashboard">
      <div class="user-status-bar">
        <div class="status-items">
          <div class="status-item">
            <span class="status-badge" id="user-status-badge">Trial</span>
            <span id="user-status-text">Loading...</span>
          </div>
          <div class="status-item"><span>üåç</span><span id="user-region">-</span></div>
          <div class="status-item"><span>üìß</span><span id="user-email">-</span></div>
        </div>
        <div class="status-item">
          <span style="background: rgba(212, 175, 55, 0.1); padding: 8px 15px; border-radius: 20px; color: #d4af37;">
            <span id="prayers-progress">0/7</span> prayers uploaded
          </span>
        </div>
      </div>

      <div class="section-panel visible" id="section-upload">
        <div class="section-header">
          <h2>üìø Upload Your Prayer Recordings</h2>
          <button class="close-section" onclick="closeSection('upload')">√ó</button>
        </div>
        <div class="alert alert-warning">
          <span>üåç</span>
          <div><strong>Record in your own language!</strong><br>Rosary73 welcomes prayers in all languages.</div>
        </div>
        <p style="margin-bottom: 20px; color: rgba(255,255,255,0.7);">For the full upload experience:</p>
        <a href="upload-prayers.html" class="btn btn-primary">üìÅ Open Full Upload Page</a>
      </div>

      <div class="section-panel" id="section-subscribe">
        <div class="section-header">
          <h2>‚≠ê Choose Your Plan</h2>
          <button class="close-section" onclick="closeSection('subscribe')">√ó</button>
        </div>
        <div id="current-plan-info" class="alert alert-success hidden">
          <span>‚úÖ</span>
          <div><strong>You're subscribed!</strong><br><span id="current-plan-details"></span></div>
        </div>
        <div class="plans-grid" id="plans-grid">
          <div class="plan-card" data-plan="threeMonth" onclick="selectPlan('threeMonth')">
            <div class="plan-duration">3 Months</div>
            <div class="plan-price"><span id="price-3mo">‚Ç±99</span></div>
          </div>
          <div class="plan-card popular" data-plan="sixMonth" onclick="selectPlan('sixMonth')">
            <div class="plan-duration">6 Months</div>
            <div class="plan-price"><span id="price-6mo">‚Ç±179</span></div>
            <div class="plan-savings">Save 10%</div>
          </div>
          <div class="plan-card" data-plan="twelveMonth" onclick="selectPlan('twelveMonth')">
            <div class="plan-duration">12 Months</div>
            <div class="plan-price"><span id="price-12mo">‚Ç±329</span></div>
            <div class="plan-savings">Save 17%</div>
          </div>
        </div>
        <h3 style="margin: 25px 0 15px; font-size: 1rem; color: rgba(255,255,255,0.8);">Select Payment Method</h3>
        <div class="payment-methods-section" id="payment-methods-subscribe">
          <div id="ewallet-group-subscribe">
            <div class="payment-group-title"><span>eWallets</span><span class="ph-only-tag">PHILIPPINES ONLY</span></div>
            <div class="payment-methods">
              <div class="payment-method" data-method="gcash" onclick="selectPaymentMethod('subscribe', 'gcash')"><div class="payment-method-icon">üíô</div><div class="payment-method-name">GCash</div></div>
              <div class="payment-method" data-method="maya" onclick="selectPaymentMethod('subscribe', 'maya')"><div class="payment-method-icon">üíö</div><div class="payment-method-name">Maya</div></div>
              <div class="payment-method" data-method="grabpay" onclick="selectPaymentMethod('subscribe', 'grabpay')"><div class="payment-method-icon">üöó</div><div class="payment-method-name">GrabPay</div></div>
              <div class="payment-method" data-method="shopeepay" onclick="selectPaymentMethod('subscribe', 'shopeepay')"><div class="payment-method-icon">üß°</div><div class="payment-method-name">ShopeePay</div></div>
            </div>
          </div>
          <div id="qrph-group-subscribe">
            <div class="payment-group-title"><span>QR PH</span><span class="ph-only-tag">PHILIPPINES ONLY</span></div>
            <div class="payment-methods">
              <div class="payment-method" data-method="qrph" onclick="selectPaymentMethod('subscribe', 'qrph')"><div class="payment-method-icon">üì±</div><div class="payment-method-name">QR PH</div></div>
            </div>
          </div>
          <div class="payment-group-title">Credit/Debit Card</div>
          <div class="payment-methods">
            <div class="payment-method" data-method="card" onclick="selectPaymentMethod('subscribe', 'card')"><div class="payment-method-icon">üí≥</div><div class="payment-method-name">Card</div></div>
          </div>
        </div>
        <button class="btn btn-primary btn-block" id="subscribe-btn" onclick="processSubscription()" disabled>Subscribe Now</button>
      </div>

      <div class="section-panel" id="section-gift">
        <div class="section-header">
          <h2>üéÅ Gift a Subscription</h2>
          <button class="close-section" onclick="closeSection('gift')">√ó</button>
        </div>
        <p style="margin-bottom: 25px; color: rgba(255,255,255,0.7);">Share the gift of prayer!</p>
        <div class="gift-form">
          <div class="form-group">
            <label>Recipient's Username or Email</label>
            <input type="text" id="gift-recipient" class="form-input" placeholder="Enter username or email">
          </div>
          <div class="form-group">
            <label>Personal Message (Optional)</label>
            <textarea id="gift-message" placeholder="Add a heartfelt message..."></textarea>
          </div>
          <h3 style="margin: 25px 0 15px; font-size: 1rem;">Select Gift Duration</h3>
          <div class="plans-grid" id="gift-plans-grid">
            <div class="plan-card" data-plan="threeMonth" onclick="selectGiftPlan('threeMonth')"><div class="plan-duration">3 Months</div><div class="plan-price"><span id="gift-price-3mo">‚Ç±99</span></div></div>
            <div class="plan-card popular" data-plan="sixMonth" onclick="selectGiftPlan('sixMonth')"><div class="plan-duration">6 Months</div><div class="plan-price"><span id="gift-price-6mo">‚Ç±179</span></div></div>
            <div class="plan-card" data-plan="twelveMonth" onclick="selectGiftPlan('twelveMonth')"><div class="plan-duration">12 Months</div><div class="plan-price"><span id="gift-price-12mo">‚Ç±329</span></div></div>
          </div>
          <h3 style="margin: 25px 0 15px; font-size: 1rem;">Select Payment Method</h3>
          <div class="payment-methods-section" id="payment-methods-gift">
            <div id="ewallet-group-gift">
              <div class="payment-group-title"><span>eWallets</span><span class="ph-only-tag">PHILIPPINES ONLY</span></div>
              <div class="payment-methods">
                <div class="payment-method" data-method="gcash" onclick="selectPaymentMethod('gift', 'gcash')"><div class="payment-method-icon">üíô</div><div class="payment-method-name">GCash</div></div>
                <div class="payment-method" data-method="maya" onclick="selectPaymentMethod('gift', 'maya')"><div class="payment-method-icon">üíö</div><div class="payment-method-name">Maya</div></div>
                <div class="payment-method" data-method="grabpay" onclick="selectPaymentMethod('gift', 'grabpay')"><div class="payment-method-icon">üöó</div><div class="payment-method-name">GrabPay</div></div>
                <div class="payment-method" data-method="shopeepay" onclick="selectPaymentMethod('gift', 'shopeepay')"><div class="payment-method-icon">üß°</div><div class="payment-method-name">ShopeePay</div></div>
              </div>
            </div>
            <div id="qrph-group-gift">
              <div class="payment-group-title"><span>QR PH</span><span class="ph-only-tag">PHILIPPINES ONLY</span></div>
              <div class="payment-methods">
                <div class="payment-method" data-method="qrph" onclick="selectPaymentMethod('gift', 'qrph')"><div class="payment-method-icon">üì±</div><div class="payment-method-name">QR PH</div></div>
              </div>
            </div>
            <div class="payment-group-title">Credit/Debit Card</div>
            <div class="payment-methods">
              <div class="payment-method" data-method="card" onclick="selectPaymentMethod('gift', 'card')"><div class="payment-method-icon">üí≥</div><div class="payment-method-name">Card</div></div>
            </div>
          </div>
          <button class="btn btn-primary btn-block" id="gift-btn" onclick="processGift()" disabled>üéÅ Send Gift</button>
        </div>
      </div>

      <div class="section-panel" id="section-donate">
        <div class="section-header">
          <h2>üíù Support Rosary73</h2>
          <button class="close-section" onclick="closeSection('donate')">√ó</button>
        </div>
        <p style="margin-bottom: 25px; color: rgba(255,255,255,0.7);">Your donation helps keep Rosary73 running. Thank you!</p>
        <h3 style="margin-bottom: 15px; font-size: 1rem;">Select Amount</h3>
        <div class="donation-grid" id="donation-grid">
          <div class="donation-amount" data-amount="100" onclick="selectDonation(100)"><div class="donation-value" id="donate-100">‚Ç±100</div></div>
          <div class="donation-amount" data-amount="200" onclick="selectDonation(200)"><div class="donation-value" id="donate-200">‚Ç±200</div></div>
          <div class="donation-amount" data-amount="300" onclick="selectDonation(300)"><div class="donation-value" id="donate-300">‚Ç±300</div></div>
          <div class="donation-amount" data-amount="500" onclick="selectDonation(500)"><div class="donation-value" id="donate-500">‚Ç±500</div></div>
        </div>
        <div class="custom-amount-input">
          <span style="color: rgba(255,255,255,0.6);">Or enter custom:</span>
          <input type="number" id="custom-donation" placeholder="Amount" min="50">
          <button class="btn btn-secondary btn-small" onclick="selectCustomDonation()">Set</button>
        </div>
        <h3 style="margin: 25px 0 15px; font-size: 1rem;">Select Payment Method</h3>
        <div class="payment-methods-section" id="payment-methods-donate">
          <div id="ewallet-group-donate">
            <div class="payment-group-title"><span>eWallets</span><span class="ph-only-tag">PHILIPPINES ONLY</span></div>
            <div class="payment-methods">
              <div class="payment-method" data-method="gcash" onclick="selectPaymentMethod('donate', 'gcash')"><div class="payment-method-icon">üíô</div><div class="payment-method-name">GCash</div></div>
              <div class="payment-method" data-method="maya" onclick="selectPaymentMethod('donate', 'maya')"><div class="payment-method-icon">üíö</div><div class="payment-method-name">Maya</div></div>
              <div class="payment-method" data-method="grabpay" onclick="selectPaymentMethod('donate', 'grabpay')"><div class="payment-method-icon">üöó</div><div class="payment-method-name">GrabPay</div></div>
              <div class="payment-method" data-method="shopeepay" onclick="selectPaymentMethod('donate', 'shopeepay')"><div class="payment-method-icon">üß°</div><div class="payment-method-name">ShopeePay</div></div>
            </div>
          </div>
          <div id="qrph-group-donate">
            <div class="payment-group-title"><span>QR PH</span><span class="ph-only-tag">PHILIPPINES ONLY</span></div>
            <div class="payment-methods">
              <div class="payment-method" data-method="qrph" onclick="selectPaymentMethod('donate', 'qrph')"><div class="payment-method-icon">üì±</div><div class="payment-method-name">QR PH</div></div>
            </div>
          </div>
          <div class="payment-group-title">Credit/Debit Card</div>
          <div class="payment-methods">
            <div class="payment-method" data-method="card" onclick="selectPaymentMethod('donate', 'card')"><div class="payment-method-icon">üí≥</div><div class="payment-method-name">Card</div></div>
          </div>
        </div>
        <button class="btn btn-primary btn-block" id="donate-btn" onclick="processDonation()" disabled>üíù Donate Now</button>
      </div>

      <div class="quick-stats">
        <h3>üìä YOUR STATISTICS</h3>
        <div class="stats-grid">
          <div class="stat-item"><div class="stat-value" id="stat-prayers">0</div><div class="stat-label">Prayers Recorded</div></div>
          <div class="stat-item"><div class="stat-value" id="stat-rosaries">0</div><div class="stat-label">Rosaries Joined</div></div>
          <div class="stat-item"><div class="stat-value" id="stat-started">0</div><div class="stat-label">Rosaries Started</div></div>
          <div class="stat-item"><div class="stat-value" id="stat-groups">0</div><div class="stat-label">Groups Joined</div></div>
          <div class="stat-item"><div class="stat-value" id="stat-member-since">-</div><div class="stat-label">Member Since</div></div>
        </div>
      </div>
    </div>
  </main>

  <footer class="footer">
    <p>Need help? <a href="contact.html">Contact Support</a> | <a href="privacy.html">Privacy</a> | <a href="terms.html">Terms</a></p>
    <p style="margin-top: 10px;">¬© 2025 Rosary73. All rights reserved.</p>
  </footer>

  <div class="toast-container" id="toast-container"></div>

  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.7.0/firebase-firestore-compat.js"></script>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyBBzm-LuWZwyOCMqYzxodpqLNn4Eg3wNDk",
      authDomain: "rosary--interact-app.firebaseapp.com",
      projectId: "rosary--interact-app",
      storageBucket: "rosary--interact-app.firebasestorage.app",
      messagingSenderId: "174985016192",
      appId: "1:174985016192:web:134b684d6f0ba731510765"
    };

    firebase.initializeApp(firebaseConfig);
    const auth = firebase.auth();
    const db = firebase.firestore();

    const FUNCTIONS_URL = 'https://us-central1-rosary--interact-app.cloudfunctions.net';
    const ADMIN_UID = '1T1zQ5seIxTBXnvCGtQDjR1E6e13';

    const PRICING = {
      PH: { currency: 'PHP', symbol: '‚Ç±', plans: { threeMonth: 99, sixMonth: 179, twelveMonth: 329 }, donations: [100, 200, 300, 500], minDonation: 50 },
      OTHER: { currency: 'USD', symbol: '$', plans: { threeMonth: 2.99, sixMonth: 5.49, twelveMonth: 9.90 }, donations: [2, 5, 10, 20], minDonation: 1 }
    };

    let currentUser = null;
    let userData = null;
    let selectedPlan = null;
    let selectedGiftPlan = null;
    let selectedDonation = null;
    let selectedPaymentMethods = { subscribe: null, gift: null, donate: null };
    let userPricing = PRICING.PH;

    document.addEventListener('DOMContentLoaded', () => {
      const storedUser = sessionStorage.getItem('rosary73UserData');
      if (storedUser) {
        userData = JSON.parse(storedUser);
        userPricing = userData.regionCode === 'PH' ? PRICING.PH : PRICING.OTHER;
        showDashboard();
        updateUI();
        updatePaymentVisibility();
      } else {
        showLoginGate();
      }
      setupLoginForm();
    });

    function setupLoginForm() {
      document.getElementById('login-form').addEventListener('submit', async (e) => {
        e.preventDefault();
        const username = document.getElementById('login-username').value.trim();
        const password = document.getElementById('login-password').value;
        const btn = document.getElementById('login-btn');
        const errorDiv = document.getElementById('login-error');
        const errorText = document.getElementById('login-error-text');
        
        errorDiv.classList.add('hidden');
        btn.disabled = true;
        btn.innerHTML = '<span class="spinner"></span> Verifying...';
        
        try {
          const response = await fetch(`${FUNCTIONS_URL}/verifyWebUser`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ username })
          });
          const result = await response.json();
          
          if (!result.valid) throw new Error(result.error || 'Username not found');
          
          btn.innerHTML = '<span class="spinner"></span> Signing in...';
          const emailToUse = result.email || `${username.toLowerCase()}@rosary73.app`;
          await auth.signInWithEmailAndPassword(emailToUse, password);
          
          userData = result;
          sessionStorage.setItem('rosary73UserData', JSON.stringify(result));
          userPricing = result.regionCode === 'PH' ? PRICING.PH : PRICING.OTHER;
          
          showDashboard();
          updateUI();
          updatePaymentVisibility();
          showToast('Welcome back, ' + result.username + '!', 'success');
        } catch (error) {
          errorDiv.classList.remove('hidden');
          let msg = error.message || 'Login failed';
          if (error.code === 'auth/wrong-password' || error.code === 'auth/invalid-credential') msg = 'Incorrect password.';
          else if (error.code === 'auth/too-many-requests') msg = 'Too many attempts. Try later.';
          errorText.textContent = msg;
        } finally {
          btn.disabled = false;
          btn.textContent = 'Sign In';
        }
      });
    }

    function logout() {
      auth.signOut();
      userData = null;
      sessionStorage.removeItem('rosary73UserData');
      // Reset UI elements to prevent stale data
      document.getElementById('user-status-badge').textContent = 'Trial';
      document.getElementById('user-status-badge').className = 'status-badge status-trial';
      document.getElementById('user-status-text').textContent = 'Loading...';
      document.getElementById('header-username').textContent = 'User';
      document.getElementById('user-email').textContent = '-';
      document.getElementById('user-region').textContent = '-';
      document.getElementById('prayers-progress').textContent = '0/7';
      showLoginGate();
      showToast('Logged out', 'success');
    }

    function showLoginGate() {
      document.getElementById('login-gate').classList.remove('hidden');
      document.getElementById('dashboard').classList.remove('visible');
      document.getElementById('members-nav').classList.remove('visible');
      document.getElementById('header-user').classList.add('hidden');
      document.getElementById('login-error').classList.add('hidden');
    }

    function showDashboard() {
      document.getElementById('login-gate').classList.add('hidden');
      document.getElementById('dashboard').classList.add('visible');
      document.getElementById('members-nav').classList.add('visible');
      document.getElementById('header-user').classList.remove('hidden');
    }

    function updatePaymentVisibility() {
      const isPH = (userData?.regionCode || 'OTHER') === 'PH';
      ['subscribe', 'gift', 'donate'].forEach(s => {
        const ew = document.getElementById(`ewallet-group-${s}`);
        const qr = document.getElementById(`qrph-group-${s}`);
        if (ew) ew.style.display = isPH ? 'block' : 'none';
        if (qr) qr.style.display = isPH ? 'block' : 'none';
      });
    }

    function updateUI() {
      if (!userData) return;
      
      document.getElementById('header-username').textContent = userData.username || 'User';
      document.getElementById('user-email').textContent = userData.email || (userData.appOnlyAccount ? 'üì± App Account' : '-');
      document.getElementById('user-region').textContent = userData.country || 'Unknown';
      
      const statusBadge = document.getElementById('user-status-badge');
      const statusText = document.getElementById('user-status-text');
      const status = userData.subscriptionStatus || 'none';
      
      // CHECK ADMIN FIRST - perpetual subscription
      const isAdmin = userData.userId === ADMIN_UID || userData.username?.toLowerCase() === 'drekki';
      
      if (isAdmin) {
        statusBadge.textContent = 'Admin';
        statusBadge.className = 'status-badge status-admin';
        statusText.textContent = 'Perpetual access';
      } else if (status === 'trial') {
        statusBadge.textContent = 'Trial';
        statusBadge.className = 'status-badge status-trial';
        // ALWAYS set statusText - check if trialEndDate exists
        if (userData.trialEndDate) {
          const endDate = new Date(userData.trialEndDate);
          const daysLeft = Math.ceil((endDate - new Date()) / (1000 * 60 * 60 * 24));
          statusText.textContent = daysLeft > 0 ? `${daysLeft} days left` : 'Trial expired';
        } else {
          statusText.textContent = 'Free trial';
        }
      } else if (status === 'active') {
        statusBadge.textContent = 'Active';
        statusBadge.className = 'status-badge status-active';
        // ALWAYS set statusText - check if subscriptionEndDate exists
        if (userData.subscriptionEndDate) {
          const endDate = new Date(userData.subscriptionEndDate);
          const daysLeft = Math.ceil((endDate - new Date()) / (1000 * 60 * 60 * 24));
          statusText.textContent = daysLeft > 0 ? `${daysLeft} days remaining` : 'Subscription ended';
        } else {
          statusText.textContent = 'Active subscription';
        }
      } else {
        // Expired or no subscription
        statusBadge.textContent = 'Expired';
        statusBadge.className = 'status-badge status-expired';
        statusText.textContent = 'Please subscribe';
      }
      
      const prayerCount = userData.prayerCount || 0;
      document.getElementById('prayers-progress').textContent = `${prayerCount}/7`;
      document.getElementById('stat-prayers').textContent = prayerCount;
      document.getElementById('stat-rosaries').textContent = userData.rosariesJoined || 0;
      document.getElementById('stat-started').textContent = userData.rosariesStarted || 0;
      document.getElementById('stat-groups').textContent = userData.groupsJoined || 0;
      
      if (userData.memberSince) {
        const d = new Date(userData.memberSince);
        document.getElementById('stat-member-since').textContent = d.toLocaleDateString('en-US', { month: 'short', year: 'numeric' });
      } else {
        document.getElementById('stat-member-since').textContent = '-';
      }
      
      updatePricing();
    }

    function updatePricing() {
      const s = userPricing.symbol, p = userPricing.plans, d = userPricing.donations;
      document.getElementById('price-3mo').textContent = s + p.threeMonth;
      document.getElementById('price-6mo').textContent = s + p.sixMonth;
      document.getElementById('price-12mo').textContent = s + p.twelveMonth;
      document.getElementById('gift-price-3mo').textContent = s + p.threeMonth;
      document.getElementById('gift-price-6mo').textContent = s + p.sixMonth;
      document.getElementById('gift-price-12mo').textContent = s + p.twelveMonth;
      document.getElementById('donate-100').textContent = s + d[0];
      document.getElementById('donate-200').textContent = s + d[1];
      document.getElementById('donate-300').textContent = s + d[2];
      document.getElementById('donate-500').textContent = s + d[3];
      document.querySelectorAll('#donation-grid .donation-amount').forEach((el, i) => { el.dataset.amount = d[i]; });
    }

    function openSection(section) {
      document.querySelectorAll('.section-panel').forEach(el => el.classList.remove('visible'));
      document.getElementById(`section-${section}`).classList.add('visible');
      document.querySelectorAll('.members-nav-item').forEach(el => el.classList.toggle('active', el.dataset.section === section));
      document.getElementById(`section-${section}`).scrollIntoView({ behavior: 'smooth' });
    }

    function closeSection(section) {
      document.getElementById(`section-${section}`).classList.remove('visible');
      document.querySelectorAll('.members-nav-item').forEach(el => { if (el.dataset.section === section) el.classList.remove('active'); });
    }

    function selectPlan(plan) {
      selectedPlan = plan;
      document.querySelectorAll('#plans-grid .plan-card').forEach(el => el.classList.toggle('selected', el.dataset.plan === plan));
      updateSubscribeButton();
    }

    function selectGiftPlan(plan) {
      selectedGiftPlan = plan;
      document.querySelectorAll('#gift-plans-grid .plan-card').forEach(el => el.classList.toggle('selected', el.dataset.plan === plan));
      updateGiftButton();
    }

    function selectDonation(amount) {
      selectedDonation = amount;
      document.querySelectorAll('#donation-grid .donation-amount').forEach(el => el.classList.toggle('selected', parseInt(el.dataset.amount) === amount));
      document.getElementById('custom-donation').value = '';
      updateDonateButton();
    }

    function selectCustomDonation() {
      const amount = parseFloat(document.getElementById('custom-donation').value);
      if (amount < userPricing.minDonation) { showToast(`Minimum is ${userPricing.symbol}${userPricing.minDonation}`, 'error'); return; }
      selectedDonation = amount;
      document.querySelectorAll('#donation-grid .donation-amount').forEach(el => el.classList.remove('selected'));
      updateDonateButton();
      showToast(`Amount set: ${userPricing.symbol}${amount}`, 'success');
    }

    function selectPaymentMethod(section, method) {
      selectedPaymentMethods[section] = method;
      document.querySelectorAll(`#payment-methods-${section} .payment-method`).forEach(el => el.classList.toggle('selected', el.dataset.method === method));
      if (section === 'subscribe') updateSubscribeButton();
      else if (section === 'gift') updateGiftButton();
      else if (section === 'donate') updateDonateButton();
    }

    function updateSubscribeButton() { document.getElementById('subscribe-btn').disabled = !selectedPlan || !selectedPaymentMethods.subscribe; }
    function updateGiftButton() { document.getElementById('gift-btn').disabled = !selectedGiftPlan || !selectedPaymentMethods.gift || !document.getElementById('gift-recipient').value.trim(); }
    function updateDonateButton() { document.getElementById('donate-btn').disabled = !selectedDonation || !selectedPaymentMethods.donate; }

    async function processSubscription() {
      const btn = document.getElementById('subscribe-btn');
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span> Processing...';
      try {
        const response = await fetch(`${FUNCTIONS_URL}/createXenditPaymentWeb`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            userId: userData.userId, type: 'subscription', plan: selectedPlan,
            amount: userPricing.plans[selectedPlan], currency: userPricing.currency,
            paymentMethod: selectedPaymentMethods.subscribe, source: 'website',
            successUrl: 'https://rosary73.com/payment-success.html',
            failureUrl: 'https://rosary73.com/payment-failed.html'
          })
        });
        const result = await response.json();
        if (!response.ok) throw new Error(result.error || 'Payment failed');
        if (result.paymentUrl) window.location.href = result.paymentUrl;
        else if (result.deepLinkUrl) window.location.href = result.deepLinkUrl;
        else throw new Error('No payment URL');
      } catch (error) {
        showToast('Payment failed: ' + error.message, 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Subscribe Now';
        updateSubscribeButton();
      }
    }

    async function processGift() {
      const recipient = document.getElementById('gift-recipient').value.trim();
      const message = document.getElementById('gift-message').value.trim();
      const btn = document.getElementById('gift-btn');
      if (!recipient) { showToast('Enter recipient', 'error'); return; }
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span> Processing...';
      try {
        const response = await fetch(`${FUNCTIONS_URL}/createXenditPaymentWeb`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            userId: userData.userId, type: 'gift', plan: selectedGiftPlan,
            amount: userPricing.plans[selectedGiftPlan], currency: userPricing.currency,
            paymentMethod: selectedPaymentMethods.gift, giftRecipient: { name: recipient, message },
            source: 'website', successUrl: 'https://rosary73.com/payment-success.html',
            failureUrl: 'https://rosary73.com/payment-failed.html'
          })
        });
        const result = await response.json();
        if (!response.ok) throw new Error(result.error || 'Payment failed');
        if (result.paymentUrl) window.location.href = result.paymentUrl;
        else if (result.deepLinkUrl) window.location.href = result.deepLinkUrl;
      } catch (error) {
        showToast('Payment failed: ' + error.message, 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = 'üéÅ Send Gift';
        updateGiftButton();
      }
    }

    async function processDonation() {
      const btn = document.getElementById('donate-btn');
      btn.disabled = true;
      btn.innerHTML = '<span class="spinner"></span> Processing...';
      try {
        const response = await fetch(`${FUNCTIONS_URL}/createXenditPaymentWeb`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            userId: userData.userId, type: 'donation', amount: selectedDonation,
            currency: userPricing.currency, paymentMethod: selectedPaymentMethods.donate,
            source: 'website', successUrl: 'https://rosary73.com/payment-success.html',
            failureUrl: 'https://rosary73.com/payment-failed.html'
          })
        });
        const result = await response.json();
        if (!response.ok) throw new Error(result.error || 'Payment failed');
        if (result.paymentUrl) window.location.href = result.paymentUrl;
        else if (result.deepLinkUrl) window.location.href = result.deepLinkUrl;
      } catch (error) {
        showToast('Payment failed: ' + error.message, 'error');
      } finally {
        btn.disabled = false;
        btn.textContent = 'üíù Donate Now';
        updateDonateButton();
      }
    }

    document.getElementById('gift-recipient')?.addEventListener('input', updateGiftButton);

    function showToast(message, type = 'info') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `<span>${type === 'success' ? '‚úÖ' : type === 'error' ? '‚ùå' : '‚ÑπÔ∏è'}</span><span>${message}</span>`;
      container.appendChild(toast);
      setTimeout(() => { toast.style.animation = 'slideIn 0.3s ease reverse'; setTimeout(() => toast.remove(), 300); }, 4000);
    }
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Subscribe - Rosary73</title>
  <meta name="description" content="Subscribe to Rosary73 and unlock all premium features">
  <link rel="icon" type="image/png" href="images/R73logo.png">
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #1a1a2e 100%); min-height: 100vh; color: #fff; }
    .header { padding: 20px; text-align: center; border-bottom: 1px solid rgba(255,255,255,0.1); }
    .logo-link { display: inline-flex; align-items: center; gap: 10px; text-decoration: none; }
    .logo { width: 50px; height: 50px; }
    .logo-text { color: #d4af37; font-size: 1.5rem; font-weight: 600; }
    .main { padding: 40px 20px; max-width: 900px; margin: 0 auto; }
    h1 { color: #ffffff; font-size: 2rem; text-align: center; margin-bottom: 10px; }
    .subtitle { color: rgba(255,255,255,0.7); text-align: center; margin-bottom: 30px; }
    
    /* Login Gate Overlay */
    .login-gate { text-align: center; padding: 60px 20px; }
    .login-gate-card { background: rgba(255,255,255,0.05); border: 2px solid rgba(212, 175, 55, 0.3); border-radius: 20px; padding: 50px 30px; max-width: 500px; margin: 0 auto; }
    .login-gate-icon { font-size: 4rem; margin-bottom: 20px; }
    .login-gate h2 { color: #d4af37; font-size: 1.5rem; margin-bottom: 15px; }
    .login-gate p { color: rgba(255,255,255,0.7); margin-bottom: 25px; line-height: 1.6; }
    .login-gate-buttons { display: flex; gap: 15px; justify-content: center; flex-wrap: wrap; }
    .gate-btn { padding: 14px 30px; border-radius: 10px; font-size: 1rem; font-weight: 600; text-decoration: none; transition: all 0.3s; }
    .gate-btn-primary { background: linear-gradient(135deg, #d4af37, #b8860b); color: #1a1a2e; border: none; }
    .gate-btn-primary:hover { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3); }
    .gate-btn-secondary { background: transparent; color: #d4af37; border: 2px solid #d4af37; cursor: pointer; }
    .gate-btn-secondary:hover { background: rgba(212, 175, 55, 0.1); }
    
    /* Tabs */
    .tabs { display: flex; justify-content: center; gap: 10px; margin-bottom: 30px; flex-wrap: wrap; }
    .tab-btn { padding: 12px 24px; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 25px; color: rgba(255,255,255,0.7); cursor: pointer; transition: all 0.3s; font-size: 0.95rem; }
    .tab-btn:hover { border-color: rgba(212, 175, 55, 0.5); }
    .tab-btn.active { background: rgba(212, 175, 55, 0.2); border-color: #d4af37; color: #d4af37; }
    .tab-content { display: none; }
    .tab-content.active { display: block; }

    /* Login Section */
    .login-section { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 25px; margin-bottom: 30px; }
    .login-section h2 { color: #d4af37; font-size: 1.2rem; margin-bottom: 15px; }
    .login-row { display: flex; gap: 10px; flex-wrap: wrap; }
    .login-row input { flex: 1; min-width: 200px; padding: 12px 16px; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 8px; color: #fff; font-size: 1rem; }
    .login-row input:focus { outline: none; border-color: #d4af37; }
    .login-row input::placeholder { color: rgba(255,255,255,0.4); }
    .login-row button { padding: 12px 24px; background: linear-gradient(135deg, #d4af37, #b8860b); border: none; border-radius: 8px; color: #1a1a2e; font-weight: 600; cursor: pointer; }
    .login-row button:hover { transform: translateY(-1px); }
    .login-row button:disabled { opacity: 0.6; cursor: not-allowed; }
    .user-info { display: flex; align-items: center; gap: 15px; flex-wrap: wrap; }
    .user-badge { background: rgba(34, 197, 94, 0.2); border: 1px solid #4ade80; padding: 8px 16px; border-radius: 20px; color: #86efac; }
    .user-badge.perpetual { background: linear-gradient(135deg, rgba(212, 175, 55, 0.3), rgba(184, 134, 11, 0.3)); border-color: #d4af37; color: #d4af37; }
    .logout-btn { background: none; border: 1px solid rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 8px; color: rgba(255,255,255,0.7); cursor: pointer; }
    .status-msg { margin-top: 10px; padding: 10px; border-radius: 8px; font-size: 0.9rem; }
    .status-error { background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); color: #fca5a5; }
    .status-success { background: rgba(34, 197, 94, 0.1); border: 1px solid rgba(34, 197, 94, 0.3); color: #86efac; }
    .hidden { display: none !important; }
    
    /* Perpetual Access Message */
    .perpetual-message {
      background: linear-gradient(135deg, rgba(212, 175, 55, 0.15), rgba(184, 134, 11, 0.15));
      border: 2px solid rgba(212, 175, 55, 0.5);
      border-radius: 16px;
      padding: 40px;
      text-align: center;
      margin-bottom: 30px;
    }
    .perpetual-message .icon { font-size: 4rem; margin-bottom: 15px; }
    .perpetual-message h3 { color: #d4af37; font-size: 1.5rem; margin-bottom: 10px; }
    .perpetual-message p { color: rgba(255,255,255,0.8); line-height: 1.6; }
    
    /* Pricing Cards */
    .pricing-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 40px; }
    .price-card { background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 25px; text-align: center; cursor: pointer; transition: all 0.3s; position: relative; }
    .price-card:hover { border-color: rgba(212, 175, 55, 0.5); transform: translateY(-3px); }
    .price-card.selected { border-color: #d4af37; background: rgba(212, 175, 55, 0.1); }
    .price-card .badge { position: absolute; top: -12px; left: 50%; transform: translateX(-50%); background: #d4af37; color: #1a1a2e; padding: 4px 12px; border-radius: 12px; font-size: 0.75rem; font-weight: 600; }
    .price-card .duration { color: #d4af37; font-size: 1.1rem; font-weight: 600; margin-bottom: 10px; }
    .price-card .price { color: #ffffff; font-size: 2.5rem; font-weight: 700; }
    .price-card .savings { color: #4ade80; font-size: 0.85rem; margin-top: 8px; }
    
    /* Donation Grid */
    .donation-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(120px, 1fr)); gap: 15px; margin-bottom: 30px; }
    .donation-card { background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 12px; padding: 20px 15px; text-align: center; cursor: pointer; transition: all 0.3s; }
    .donation-card:hover { border-color: rgba(212, 175, 55, 0.5); }
    .donation-card.selected { border-color: #d4af37; background: rgba(212, 175, 55, 0.1); }
    .donation-card .amount { color: #d4af37; font-size: 1.5rem; font-weight: 700; }
    .donation-card .label { color: rgba(255,255,255,0.6); font-size: 0.8rem; margin-top: 5px; }
    .custom-amount { margin-bottom: 30px; }
    .custom-amount input { width: 100%; padding: 14px 16px; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 8px; color: #fff; font-size: 1.1rem; text-align: center; }
    .custom-amount input:focus { outline: none; border-color: #d4af37; }
    
    /* Payment Methods */
    .payment-section { background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1); border-radius: 16px; padding: 25px; }
    .payment-section h2 { color: #ffffff; font-size: 1.2rem; margin-bottom: 20px; text-align: center; }
    .payment-group { margin-bottom: 20px; }
    .payment-group-title { color: rgba(255,255,255,0.6); font-size: 0.85rem; margin-bottom: 10px; display: flex; align-items: center; gap: 8px; }
    .web-only-tag { background: #4ade80; color: #1a1a2e; padding: 2px 8px; border-radius: 4px; font-size: 0.7rem; font-weight: 600; }
    .payment-methods { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 10px; }
    .payment-btn { padding: 15px; background: rgba(255,255,255,0.05); border: 2px solid rgba(255,255,255,0.1); border-radius: 10px; color: #fff; cursor: pointer; transition: all 0.3s; display: flex; flex-direction: column; align-items: center; gap: 5px; }
    .payment-btn:hover { border-color: rgba(212, 175, 55, 0.5); }
    .payment-btn.selected { border-color: #d4af37; background: rgba(212, 175, 55, 0.1); }
    .payment-btn:disabled { opacity: 0.4; cursor: not-allowed; }
    .payment-btn .icon { font-size: 1.5rem; }
    .payment-btn .name { font-size: 0.85rem; }
    .pay-logo { width: 32px; height: 32px; object-fit: contain; border-radius: 6px; }
    
    /* Card Logos */
    .card-logos { display: flex; gap: 8px; align-items: center; justify-content: center; margin-bottom: 5px; }
    .card-logo { height: 24px; width: auto; }
    .card-logo-visa { background: #1a1f71; padding: 4px 8px; border-radius: 4px; }
    .card-logo-mc { background: linear-gradient(90deg, #eb001b 0%, #f79e1b 100%); padding: 4px 8px; border-radius: 4px; }
    .card-logo-jcb { background: linear-gradient(135deg, #0066cc 0%, #cc0000 50%, #00aa00 100%); padding: 4px 8px; border-radius: 4px; }
    .card-logo-text { color: white; font-size: 0.7rem; font-weight: 700; font-style: italic; }
    
    /* Action Button */
    .action-btn { width: 100%; padding: 18px; background: linear-gradient(135deg, #d4af37, #b8860b); border: none; border-radius: 12px; color: #1a1a2e; font-size: 1.2rem; font-weight: 700; cursor: pointer; margin-top: 25px; transition: all 0.3s; }
    .action-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 10px 30px rgba(212, 175, 55, 0.3); }
    .action-btn:disabled { opacity: 0.6; cursor: not-allowed; }
    
    /* Free Subscription Section */
    .free-section { background: linear-gradient(135deg, #1e3a5f 0%, #1a2e4a 100%); border: 1px solid #3b82f6; border-radius: 16px; padding: 30px; margin-bottom: 30px; text-align: center; }
    .free-section h3 { color: #60a5fa; font-size: 1.3rem; margin-bottom: 15px; }
    .free-section p { color: rgba(255,255,255,0.8); margin-bottom: 20px; line-height: 1.6; }
    .free-section .icon { font-size: 3rem; margin-bottom: 15px; }
    .free-btn { padding: 14px 30px; background: #3b82f6; border: none; border-radius: 10px; color: #fff; font-size: 1rem; font-weight: 600; cursor: pointer; transition: all 0.3s; }
    .free-btn:hover { background: #2563eb; transform: translateY(-2px); }
    
    /* Upgrade Section */
    .upgrade-info { background: rgba(34, 197, 94, 0.1); border: 1px solid #4ade80; border-radius: 12px; padding: 20px; margin-bottom: 20px; }
    .upgrade-info h3 { color: #4ade80; margin-bottom: 10px; }
    .upgrade-info p { color: rgba(255,255,255,0.8); font-size: 0.9rem; }
    
    /* Processing Overlay */
    .processing-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); display: flex; align-items: center; justify-content: center; z-index: 1000; }
    .processing-content { text-align: center; color: #fff; }
    .processing-spinner { width: 50px; height: 50px; border: 4px solid rgba(212, 175, 55, 0.3); border-top-color: #d4af37; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 20px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    
    .footer { padding: 30px 20px; text-align: center; border-top: 1px solid rgba(255,255,255,0.1); }
    .footer p { color: rgba(255,255,255,0.4); font-size: 0.85rem; }
    .footer a { color: #d4af37; text-decoration: none; }
    
    @media (max-width: 480px) {
      .tabs { gap: 8px; }
      .tab-btn { padding: 10px 16px; font-size: 0.85rem; }
      .price-card .price { font-size: 2rem; }
      .login-gate-buttons { flex-direction: column; }
      .gate-btn { width: 100%; text-align: center; }
    }
  </style>
</head>
<body>
  <header class="header">
    <a href="index.html" class="logo-link">
      <img src="images/R73logo.png" alt="Rosary73" class="logo">
      <span class="logo-text">Rosary73</span>
    </a>
  </header>

  <main class="main">
    <!-- Login Gate (shown when not logged in) -->
    <div id="login-gate" class="login-gate">
      <div class="login-gate-card">
        <div class="login-gate-icon">&#128274;</div>
        <h2>Sign Up First to See Your Rates</h2>
        <p>
          To show you the correct regional pricing and payment methods for your country, 
          please create an account or log in first.
        </p>
        <div class="login-gate-buttons">
          <a href="signup.html" class="gate-btn gate-btn-primary">Create Free Account</a>
          <button class="gate-btn gate-btn-secondary" onclick="showLoginForm()">I Have an Account</button>
        </div>
        
        <!-- Hidden Login Form -->
        <div id="gate-login-form" class="hidden" style="margin-top: 30px; text-align: left;">
          <div class="login-row">
            <input type="text" id="gate-username-input" placeholder="Enter your username" autocomplete="username">
            <button onclick="verifyUserFromGate()" id="gate-verify-btn">Continue</button>
          </div>
          <div id="gate-login-status" class="status-msg hidden" style="margin-top: 10px;"></div>
        </div>
      </div>
    </div>

    <!-- Main Content (shown when logged in) -->
    <div id="main-content" class="hidden">
      <h1>Support Rosary73</h1>
      <p class="subtitle">Choose how you'd like to support our prayer community</p>

      <!-- Tabs -->
      <div class="tabs" id="tabs-container">
        <button class="tab-btn active" onclick="switchTab('subscribe')">&#11088; Subscribe</button>
        <button class="tab-btn" onclick="switchTab('upgrade')">&#8593; Upgrade</button>
        <button class="tab-btn" onclick="switchTab('donate')">&#10084; Donate</button>
        <button class="tab-btn" onclick="switchTab('free')">&#10013; Free for Clergy/Religious</button>
      </div>

      <!-- User Info Section -->
      <div class="login-section">
        <div id="user-logged-in">
          <div class="user-info">
            <span class="user-badge" id="user-badge">&#128100; <span id="logged-username"></span></span>
            <span style="color: rgba(255,255,255,0.6);" id="subscription-status"></span>
            <button class="logout-btn" onclick="logout()">Change User</button>
          </div>
        </div>
      </div>

      <!-- Perpetual Access Message (hidden by default) -->
      <div id="perpetual-message" class="perpetual-message hidden">
        <div class="icon">&#10024;</div>
        <h3>You Have Perpetual Access!</h3>
        <p>Thank you for being a valued member of Rosary73. You have lifetime access to all features.<br>If you'd like to support our mission, consider making a donation below.</p>
      </div>

      <!-- Tab: Subscribe -->
      <div id="tab-subscribe" class="tab-content active">
        <h2 style="color: #d4af37; margin-bottom: 20px; text-align: center;">Choose Your Plan</h2>
        
        <div class="pricing-grid" id="pricing-grid">
          <div class="price-card" data-plan="threeMonth" onclick="selectPlan('threeMonth')">
            <div class="duration">3 Months</div>
            <div class="price" id="price-3"></div>
          </div>
          <div class="price-card selected" data-plan="sixMonth" onclick="selectPlan('sixMonth')">
            <div class="badge">MOST POPULAR</div>
            <div class="duration">6 Months</div>
            <div class="price" id="price-6"></div>
            <div class="savings">Save 10%</div>
          </div>
          <div class="price-card" data-plan="twelveMonth" onclick="selectPlan('twelveMonth')">
            <div class="badge">BEST VALUE</div>
            <div class="duration">12 Months</div>
            <div class="price" id="price-12"></div>
            <div class="savings">Save 17%</div>
          </div>
        </div>

        <div class="payment-section" id="payment-section-sub">
          <h2>Select Payment Method</h2>
          <div class="payment-group" id="ewallet-group-sub">
            <div class="payment-group-title">
              <span>eWallets</span>
              <span class="web-only-tag">PHILIPPINES ONLY</span>
            </div>
            <div class="payment-methods">
              <button class="payment-btn" data-method="gcash" onclick="selectPayment('gcash', 'sub')"><img src="images/GCash.png" class="pay-logo"><span class="name">GCash</span></button>
              <button class="payment-btn" data-method="maya" onclick="selectPayment('maya', 'sub')"><img src="images/Maya.png" class="pay-logo"><span class="name">Maya</span></button>
              <button class="payment-btn" data-method="grabpay" onclick="selectPayment('grabpay', 'sub')"><img src="images/Grabpay.png" class="pay-logo"><span class="name">GrabPay</span></button>
              <button class="payment-btn" data-method="shopeepay" onclick="selectPayment('shopeepay', 'sub')"><img src="images/Shopeepay.png" class="pay-logo"><span class="name">ShopeePay</span></button>
            </div>
          </div>
          <div class="payment-group" id="qrph-group-sub">
            <div class="payment-group-title">
              <span>QR PH (InstaPay/PESONet)</span>
              <span class="web-only-tag">PHILIPPINES ONLY</span>
            </div>
            <div class="payment-methods">
              <button class="payment-btn" data-method="qrph" onclick="selectPayment('qrph', 'sub')"><span class="icon">&#128241;</span><span class="name">QR PH</span></button>
            </div>
          </div>
          <div class="payment-group">
            <div class="payment-group-title">Credit/Debit Card</div>
            <div class="payment-methods">
              <button class="payment-btn" data-method="card" onclick="selectPayment('card', 'sub')">
                <div class="card-logos">
                  <span class="card-logo card-logo-visa"><span class="card-logo-text">VISA</span></span>
                  <span class="card-logo card-logo-mc"><span class="card-logo-text">MC</span></span>
                  <span class="card-logo card-logo-jcb"><span class="card-logo-text">JCB</span></span>
                </div>
                <span class="name">Credit/Debit Card</span>
              </button>
            </div>
          </div>
          <button class="action-btn" id="subscribe-btn" onclick="processPayment('subscription')" disabled>Select a payment method</button>
        </div>
      </div>

      <!-- Tab: Upgrade -->
      <div id="tab-upgrade" class="tab-content">
        <div class="upgrade-info">
          <h3>&#8593; Extend Your Subscription</h3>
          <p>Already a subscriber? Add more time to your current plan. Your new subscription period will be added to your existing end date.</p>
        </div>
        
        <h2 style="color: #d4af37; margin-bottom: 20px; text-align: center;">Add Time to Your Subscription</h2>
        
        <div class="pricing-grid">
          <div class="price-card" data-plan="threeMonth" onclick="selectUpgradePlan('threeMonth')">
            <div class="duration">+3 Months</div>
            <div class="price" id="upgrade-price-3"></div>
          </div>
          <div class="price-card selected" data-plan="sixMonth" onclick="selectUpgradePlan('sixMonth')">
            <div class="badge">MOST POPULAR</div>
            <div class="duration">+6 Months</div>
            <div class="price" id="upgrade-price-6"></div>
            <div class="savings">Save 10%</div>
          </div>
          <div class="price-card" data-plan="twelveMonth" onclick="selectUpgradePlan('twelveMonth')">
            <div class="badge">BEST VALUE</div>
            <div class="duration">+12 Months</div>
            <div class="price" id="upgrade-price-12"></div>
            <div class="savings">Save 17%</div>
          </div>
        </div>

        <div class="payment-section">
          <h2>Payment Method</h2>
          <div class="payment-group" id="ewallet-group-upgrade">
            <div class="payment-group-title"><span>eWallets</span><span class="web-only-tag">PHILIPPINES ONLY</span></div>
            <div class="payment-methods">
              <button class="payment-btn" data-method="gcash" onclick="selectPayment('gcash', 'upgrade')"><img src="images/GCash.png" class="pay-logo"><span class="name">GCash</span></button>
              <button class="payment-btn" data-method="maya" onclick="selectPayment('maya', 'upgrade')"><img src="images/Maya.png" class="pay-logo"><span class="name">Maya</span></button>
              <button class="payment-btn" data-method="grabpay" onclick="selectPayment('grabpay', 'upgrade')"><img src="images/Grabpay.png" class="pay-logo"><span class="name">GrabPay</span></button>
              <button class="payment-btn" data-method="shopeepay" onclick="selectPayment('shopeepay', 'upgrade')"><img src="images/Shopeepay.png" class="pay-logo"><span class="name">ShopeePay</span></button>
            </div>
          </div>
          <div class="payment-group" id="qrph-group-upgrade">
            <div class="payment-group-title"><span>QR PH</span><span class="web-only-tag">PHILIPPINES ONLY</span></div>
            <div class="payment-methods">
              <button class="payment-btn" data-method="qrph" onclick="selectPayment('qrph', 'upgrade')"><span class="icon">&#128241;</span><span class="name">QR PH</span></button>
            </div>
          </div>
          <div class="payment-group">
            <div class="payment-group-title">Credit/Debit Card</div>
            <div class="payment-methods">
              <button class="payment-btn" data-method="card" onclick="selectPayment('card', 'upgrade')">
                <div class="card-logos">
                  <span class="card-logo card-logo-visa"><span class="card-logo-text">VISA</span></span>
                  <span class="card-logo card-logo-mc"><span class="card-logo-text">MC</span></span>
                  <span class="card-logo card-logo-jcb"><span class="card-logo-text">JCB</span></span>
                </div>
                <span class="name">Credit/Debit Card</span>
              </button>
            </div>
          </div>
          <button class="action-btn" id="upgrade-btn" onclick="processPayment('upgrade')" disabled>Select a payment method</button>
        </div>
      </div>

      <!-- Tab: Donate -->
      <div id="tab-donate" class="tab-content">
        <h2 style="color: #d4af37; margin-bottom: 10px; text-align: center;">Make a Donation</h2>
        <p style="color: rgba(255,255,255,0.7); text-align: center; margin-bottom: 25px;">Your donation helps keep Rosary73 running and accessible to all.</p>
        
        <div class="donation-grid" id="donation-grid"></div>
        
        <div class="custom-amount">
          <input type="number" id="custom-donation" placeholder="Or enter custom amount" min="1" onchange="selectCustomDonation()">
        </div>

        <div class="payment-section">
          <h2>Payment Method</h2>
          <div class="payment-group" id="ewallet-group-donate">
            <div class="payment-group-title"><span>eWallets</span><span class="web-only-tag">PHILIPPINES ONLY</span></div>
            <div class="payment-methods">
              <button class="payment-btn" data-method="gcash" onclick="selectPayment('gcash', 'donate')"><img src="images/GCash.png" class="pay-logo"><span class="name">GCash</span></button>
              <button class="payment-btn" data-method="maya" onclick="selectPayment('maya', 'donate')"><img src="images/Maya.png" class="pay-logo"><span class="name">Maya</span></button>
              <button class="payment-btn" data-method="grabpay" onclick="selectPayment('grabpay', 'donate')"><img src="images/Grabpay.png" class="pay-logo"><span class="name">GrabPay</span></button>
              <button class="payment-btn" data-method="shopeepay" onclick="selectPayment('shopeepay', 'donate')"><img src="images/Shopeepay.png" class="pay-logo"><span class="name">ShopeePay</span></button>
            </div>
          </div>
          <div class="payment-group" id="qrph-group-donate">
            <div class="payment-group-title"><span>QR PH</span><span class="web-only-tag">PHILIPPINES ONLY</span></div>
            <div class="payment-methods">
              <button class="payment-btn" data-method="qrph" onclick="selectPayment('qrph', 'donate')"><span class="icon">&#128241;</span><span class="name">QR PH</span></button>
            </div>
          </div>
          <div class="payment-group">
            <div class="payment-group-title">Credit/Debit Card</div>
            <div class="payment-methods">
              <button class="payment-btn" data-method="card" onclick="selectPayment('card', 'donate')">
                <div class="card-logos">
                  <span class="card-logo card-logo-visa"><span class="card-logo-text">VISA</span></span>
                  <span class="card-logo card-logo-mc"><span class="card-logo-text">MC</span></span>
                  <span class="card-logo card-logo-jcb"><span class="card-logo-text">JCB</span></span>
                </div>
                <span class="name">Credit/Debit Card</span>
              </button>
            </div>
          </div>
          <button class="action-btn" id="donate-btn" onclick="processPayment('donation')" disabled>Select amount and payment method</button>
        </div>
      </div>

      <!-- Tab: Free for Clergy/Religious -->
      <div id="tab-free" class="tab-content">
        <div class="free-section">
          <div class="icon">&#10013;</div>
          <h3>Free Subscription for Clergy, Religious &amp; Those in Need</h3>
          <p>
            Rosary73 is committed to making prayer accessible to all. If you are a priest, religious sister/brother, 
            seminarian, or someone who cannot afford a subscription, please contact us for a free account.
          </p>
          <p style="margin-top: 15px; font-size: 0.9rem;">
            We believe that financial constraints should never be a barrier to prayer. Simply send us an email 
            explaining your situation, and we will gladly provide you with complimentary access.
          </p>
          <a href="mailto:support@rosary73.com?subject=Free%20Subscription%20Request" class="free-btn" style="display: inline-block; margin-top: 20px; text-decoration: none;">
            &#9993; Request Free Access
          </a>
        </div>
        <p style="text-align: center; color: rgba(255,255,255,0.5); font-size: 0.85rem;">
          All requests are handled with discretion and respect for your privacy.
        </p>
      </div>
    </div>
  </main>

  <div class="processing-overlay hidden" id="processing-overlay">
    <div class="processing-content">
      <div class="processing-spinner"></div>
      <p>Redirecting to payment...</p>
    </div>
  </div>

  <footer class="footer">
    <p>Secure payments powered by Xendit</p>
    <p style="margin-top: 10px;"><a href="terms.html">Terms</a> | <a href="privacy.html">Privacy</a> | <a href="contact.html">Support</a></p>
  </footer>

  <script>
    // Cloud Functions URL - using WEB endpoint for website payments
    var FUNCTIONS_URL = 'https://us-central1-rosary--interact-app.cloudfunctions.net';
    var currentUser = null;
    var selectedPlan = 'sixMonth';
    var selectedUpgradePlan = 'sixMonth';
    var selectedDonation = null;
    var selectedPaymentSub = null;
    var selectedPaymentUpgrade = null;
    var selectedPaymentDonate = null;
    var currentRegion = 'OTHER';
    var isPerpetualUser = false;

    var PRICING = {
      PH: { threeMonth: 99, sixMonth: 149, twelveMonth: 249, currency: 'PHP', symbol: '\u20B1' },
      OTHER: { threeMonth: 2.99, sixMonth: 5.49, twelveMonth: 9.90, currency: 'USD', symbol: '$' }
    };
    
    var DONATIONS = {
      PH: [
        { amount: 50, label: 'Small gift' },
        { amount: 100, label: 'Cup of coffee' },
        { amount: 200, label: 'Supporter' },
        { amount: 500, label: 'Generous' },
        { amount: 1000, label: 'Patron' }
      ],
      OTHER: [
        { amount: 2, label: 'Small gift' },
        { amount: 5, label: 'Cup of coffee' },
        { amount: 10, label: 'Supporter' },
        { amount: 25, label: 'Generous' },
        { amount: 50, label: 'Patron' }
      ]
    };

    function init() {
      var saved = sessionStorage.getItem('rosary73User');
      if (saved) {
        currentUser = JSON.parse(saved);
        currentRegion = currentUser.regionCode || 'OTHER';
        checkPerpetualStatus();
        showMainContent();
      } else {
        showLoginGate();
      }
    }

    function checkPerpetualStatus() {
      // Check for perpetual/admin/special access
      isPerpetualUser = (
        currentUser.isPerpetual === true ||
        currentUser.isAdmin === true ||
        currentUser.hasSpecialAccess === true ||
        currentUser.subscriptionStatus === 'perpetual' ||
        currentUser.subscriptionStatus === 'special_access'
      );
    }

    function showLoginGate() {
      document.getElementById('login-gate').classList.remove('hidden');
      document.getElementById('main-content').classList.add('hidden');
    }

    function showMainContent() {
      document.getElementById('login-gate').classList.add('hidden');
      document.getElementById('main-content').classList.remove('hidden');
      showLoggedIn();
      updatePricing();
      updateDonationGrid();
      updatePaymentVisibility();
      
      // Handle perpetual users
      if (isPerpetualUser) {
        showPerpetualUI();
      }
    }

    function showPerpetualUI() {
      // Show perpetual message
      document.getElementById('perpetual-message').classList.remove('hidden');
      
      // Hide subscribe and upgrade tabs, show only donate tab
      document.getElementById('tab-subscribe').classList.add('hidden');
      document.getElementById('tab-upgrade').classList.add('hidden');
      document.getElementById('pricing-grid').classList.add('hidden');
      
      // Switch to donate tab by default
      switchTab('donate');
      
      // Update tabs - hide subscribe and upgrade buttons
      var tabButtons = document.querySelectorAll('.tab-btn');
      tabButtons.forEach(function(btn) {
        var onclick = btn.getAttribute('onclick');
        if (onclick && (onclick.includes('subscribe') || onclick.includes('upgrade'))) {
          btn.style.display = 'none';
        }
      });
    }

    function showLoginForm() {
      document.getElementById('gate-login-form').classList.remove('hidden');
      document.getElementById('gate-username-input').focus();
    }

    async function verifyUserFromGate() {
      var username = document.getElementById('gate-username-input').value.trim();
      if (!username) return;
      var btn = document.getElementById('gate-verify-btn');
      var status = document.getElementById('gate-login-status');
      btn.disabled = true;
      btn.textContent = 'Checking...';
      try {
        var response = await fetch(FUNCTIONS_URL + '/verifyWebUser', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username: username })
        });
        var result = await response.json();
        if (!response.ok) {
          status.className = 'status-msg status-error';
          status.textContent = result.error;
          status.classList.remove('hidden');
          if (result.requiresVerification) {
            status.innerHTML = result.error + ' <a href="verify-email.html" style="color:#d4af37;">Verify now</a>';
          }
          return;
        }
        currentUser = result;
        currentRegion = result.regionCode || 'OTHER';
        sessionStorage.setItem('rosary73User', JSON.stringify(result));
        checkPerpetualStatus();
        showMainContent();
      } catch (error) {
        status.className = 'status-msg status-error';
        status.textContent = 'Connection error. Please try again.';
        status.classList.remove('hidden');
      } finally {
        btn.disabled = false;
        btn.textContent = 'Continue';
      }
    }

    function switchTab(tab) {
      document.querySelectorAll('.tab-btn').forEach(function(btn) { btn.classList.remove('active'); });
      document.querySelectorAll('.tab-content').forEach(function(content) { content.classList.remove('active'); });
      var tabBtn = document.querySelector('.tab-btn[onclick*="' + tab + '"]');
      if (tabBtn) tabBtn.classList.add('active');
      var tabContent = document.getElementById('tab-' + tab);
      if (tabContent) tabContent.classList.add('active');
    }

    function showLoggedIn() {
      document.getElementById('logged-username').textContent = currentUser.username;
      
      var statusEl = document.getElementById('subscription-status');
      var badgeEl = document.getElementById('user-badge');
      
      // Check for perpetual/admin/special access FIRST
      if (isPerpetualUser) {
        statusEl.textContent = '\u2728 Perpetual Access';
        statusEl.style.color = '#d4af37';
        badgeEl.classList.add('perpetual');
      } else if (currentUser.subscriptionStatus === 'active') {
        statusEl.textContent = '\u2705 Active Subscriber';
      } else if (currentUser.subscriptionStatus === 'trial') {
        statusEl.textContent = '\u23F3 Free Trial';
      } else {
        statusEl.textContent = '\u26A0 Expired';
      }
    }

    function logout() {
      currentUser = null;
      currentRegion = 'OTHER';
      isPerpetualUser = false;
      sessionStorage.removeItem('rosary73User');
      showLoginGate();
      // Reset gate login form
      document.getElementById('gate-login-form').classList.add('hidden');
      document.getElementById('gate-login-status').classList.add('hidden');
      document.getElementById('gate-username-input').value = '';
      // Reset perpetual UI
      document.getElementById('perpetual-message').classList.add('hidden');
      document.getElementById('tab-subscribe').classList.remove('hidden');
      document.getElementById('tab-upgrade').classList.remove('hidden');
      document.getElementById('pricing-grid').classList.remove('hidden');
      document.querySelectorAll('.tab-btn').forEach(function(btn) { btn.style.display = ''; });
    }

    function updatePaymentVisibility() {
      var isPH = currentRegion === 'PH';
      ['sub', 'upgrade', 'donate'].forEach(function(type) {
        var ewallet = document.getElementById('ewallet-group-' + type);
        var qrph = document.getElementById('qrph-group-' + type);
        if (ewallet) ewallet.style.display = isPH ? 'block' : 'none';
        if (qrph) qrph.style.display = isPH ? 'block' : 'none';
      });
    }

    function formatPrice(amount, symbol) {
      if (symbol === '$') {
        return symbol + amount.toFixed(2);
      }
      return symbol + amount;
    }

    function updatePricing() {
      var p = PRICING[currentRegion];
      document.getElementById('price-3').innerHTML = formatPrice(p.threeMonth, p.symbol);
      document.getElementById('price-6').innerHTML = formatPrice(p.sixMonth, p.symbol);
      document.getElementById('price-12').innerHTML = formatPrice(p.twelveMonth, p.symbol);
      document.getElementById('upgrade-price-3').innerHTML = formatPrice(p.threeMonth, p.symbol);
      document.getElementById('upgrade-price-6').innerHTML = formatPrice(p.sixMonth, p.symbol);
      document.getElementById('upgrade-price-12').innerHTML = formatPrice(p.twelveMonth, p.symbol);
    }

    function updateDonationGrid() {
      var donations = DONATIONS[currentRegion];
      var p = PRICING[currentRegion];
      var grid = document.getElementById('donation-grid');
      grid.innerHTML = '';
      donations.forEach(function(d) {
        var card = document.createElement('div');
        card.className = 'donation-card';
        card.setAttribute('data-amount', d.amount);
        card.onclick = function() { selectDonation(d.amount); };
        card.innerHTML = '<div class="amount">' + p.symbol + d.amount + '</div><div class="label">' + d.label + '</div>';
        grid.appendChild(card);
      });
    }

    function selectPlan(plan) {
      selectedPlan = plan;
      document.querySelectorAll('#tab-subscribe .price-card').forEach(function(card) {
        card.classList.toggle('selected', card.dataset.plan === plan);
      });
      updateSubscribeButton();
    }

    function selectUpgradePlan(plan) {
      selectedUpgradePlan = plan;
      document.querySelectorAll('#tab-upgrade .price-card').forEach(function(card) {
        card.classList.toggle('selected', card.dataset.plan === plan);
      });
      updateUpgradeButton();
    }

    function selectDonation(amount) {
      selectedDonation = amount;
      document.getElementById('custom-donation').value = '';
      document.querySelectorAll('.donation-card').forEach(function(card) {
        card.classList.toggle('selected', parseInt(card.dataset.amount) === amount);
      });
      updateDonateButton();
    }

    function selectCustomDonation() {
      var val = parseFloat(document.getElementById('custom-donation').value);
      if (val > 0) {
        selectedDonation = val;
        document.querySelectorAll('.donation-card').forEach(function(card) { card.classList.remove('selected'); });
        updateDonateButton();
      }
    }

    function selectPayment(method, type) {
      if (type === 'sub') {
        selectedPaymentSub = method;
        document.querySelectorAll('#tab-subscribe .payment-btn').forEach(function(btn) {
          btn.classList.toggle('selected', btn.dataset.method === method);
        });
        updateSubscribeButton();
      } else if (type === 'upgrade') {
        selectedPaymentUpgrade = method;
        document.querySelectorAll('#tab-upgrade .payment-btn').forEach(function(btn) {
          btn.classList.toggle('selected', btn.dataset.method === method);
        });
        updateUpgradeButton();
      } else if (type === 'donate') {
        selectedPaymentDonate = method;
        document.querySelectorAll('#tab-donate .payment-btn').forEach(function(btn) {
          btn.classList.toggle('selected', btn.dataset.method === method);
        });
        updateDonateButton();
      }
    }

    function updateSubscribeButton() {
      var btn = document.getElementById('subscribe-btn');
      if (!selectedPaymentSub) { btn.textContent = 'Select a payment method'; btn.disabled = true; }
      else {
        var p = PRICING[currentRegion];
        btn.textContent = 'Subscribe for ' + formatPrice(p[selectedPlan], p.symbol);
        btn.disabled = false;
      }
    }

    function updateUpgradeButton() {
      var btn = document.getElementById('upgrade-btn');
      if (!selectedPaymentUpgrade) { btn.textContent = 'Select a payment method'; btn.disabled = true; }
      else {
        var p = PRICING[currentRegion];
        btn.textContent = 'Extend for ' + formatPrice(p[selectedUpgradePlan], p.symbol);
        btn.disabled = false;
      }
    }

    function updateDonateButton() {
      var btn = document.getElementById('donate-btn');
      if (!selectedDonation) { btn.textContent = 'Select an amount'; btn.disabled = true; }
      else if (!selectedPaymentDonate) { btn.textContent = 'Select a payment method'; btn.disabled = true; }
      else {
        var p = PRICING[currentRegion];
        btn.textContent = 'Donate ' + p.symbol + selectedDonation;
        btn.disabled = false;
      }
    }

    async function processPayment(type) {
      if (!currentUser) return;
      var overlay = document.getElementById('processing-overlay');
      overlay.classList.remove('hidden');
      try {
        var p = PRICING[currentRegion];
        var payload = {
          userId: currentUser.userId,
          currency: p.currency,
          source: 'website',
          successUrl: 'https://rosary73.com/payment-success.html',
          failureUrl: 'https://rosary73.com/payment-failed.html'
        };
        if (type === 'subscription' || type === 'upgrade') {
          var plan = type === 'subscription' ? selectedPlan : selectedUpgradePlan;
          var payment = type === 'subscription' ? selectedPaymentSub : selectedPaymentUpgrade;
          payload.type = type === 'upgrade' ? 'subscription_extension' : 'subscription';
          payload.plan = plan;
          payload.amount = p[plan];
          payload.paymentMethod = payment;
        } else if (type === 'donation') {
          payload.type = 'donation';
          payload.amount = selectedDonation;
          payload.paymentMethod = selectedPaymentDonate;
        }
        var response = await fetch(FUNCTIONS_URL + '/createXenditPaymentWeb', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });
        var result = await response.json();
        if (!response.ok) throw new Error(result.error || 'Payment failed. Please try again.');
        if (result.paymentUrl) { window.location.href = result.paymentUrl; }
        else if (result.deepLinkUrl) { window.location.href = result.deepLinkUrl; }
        else { throw new Error('No payment URL received'); }
      } catch (error) {
        overlay.classList.add('hidden');
        alert('Payment error: ' + error.message);
      }
    }

    document.addEventListener('DOMContentLoaded', init);
    document.getElementById('gate-username-input').addEventListener('keypress', function(e) {
      if (e.key === 'Enter') verifyUserFromGate();
    });
  </script>
</body>
</html>
